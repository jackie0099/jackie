<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fleet Master Cloud Pro v2.6</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #e11d48; --accent: #0ea5e9; --bg: #0f172a; }
        body { font-family: 'Noto Sans Lao', sans-serif; background: var(--bg); color: white; margin: 0; padding: 15px; }
        .panel { background: white; color: #1e293b; padding: 20px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 10px 15px rgba(0,0,0,0.3); }
        input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; margin-bottom: 10px; font-family: inherit; }
        .btn { border: none; padding: 14px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; font-family: inherit; transition: 0.2s; }
        .btn-main { background: var(--primary); color: white; }
        .fleet-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .car-card { background: white; color: #1e293b; padding: 15px; border-radius: 16px; border-left: 10px solid #cbd5e1; position: relative; }
        .car-card.busy { border-left-color: var(--primary); background: #fff1f2; opacity: 0.8; }
        .car-card.free { border-left-color: #22c55e; }
        .plate { font-size: 1.5rem; font-weight: 800; color: #0f172a; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 9999; }
    </style>
</head>
<body>

<div id="loader">‚öôÔ∏è ‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÄ‡∫ä‡∫∑‡ªà‡∫≠‡∫°‡∫ï‡ªç‡ªà Cloud...</div>

<header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    <div style="font-size:1.3rem; font-weight:700;">üöõ Fleet Master <span style="color:var(--accent)">Cloud</span></div>
    <button class="btn" style="width:auto; padding:8px 15px; background:rgba(255,255,255,0.1); color:white;" onclick="syncData()">üîÑ Refresh</button>
</header>

<div class="panel">
    <h3 style="margin-top:0; color:#334155;">‚ûï ‡ªÄ‡∫û‡∫µ‡ªà‡∫°‡∫•‡∫ª‡∫î‡ªÉ‡ªù‡ªà</h3>
    <input type="text" id="newP" placeholder="‡∫ó‡∫∞‡∫ö‡∫Ω‡∫ô‡∫•‡∫ª‡∫î (‡∫Å‡∫Å 1111)">
    <input type="text" id="newD" placeholder="‡∫ä‡∫∑‡ªà‡∫Ñ‡∫ª‡∫ô‡∫Ç‡∫±‡∫ö">
    <input type="text" id="newPh" placeholder="‡ªÄ‡∫ö‡∫µ‡ªÇ‡∫ó">
    <button class="btn btn-main" onclick="addCar()">üíæ ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫•‡∫ª‡∫á Cloud</button>
</div>

<div id="fleet" class="fleet-grid"></div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbx2x2LMFSNQBFeFms646RDYHUpnxGUX-jl12zms6M6RdgPy8hkcqgqfpXi96W9Q5Vjp/exec";

    async function syncData() {
        document.getElementById('loader').style.display = 'flex';
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            render(data.fleet, data.tours);
        } catch (e) {
            alert("‚ùå ‡∫ö‡ªç‡ªà‡∫™‡∫≤‡∫°‡∫≤‡∫î‡ªÄ‡∫ä‡∫∑‡ªà‡∫≠‡∫°‡∫ï‡ªç‡ªà Cloud ‡ªÑ‡∫î‡ªâ! ‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫Å‡∫ß‡∫î‡∫™‡∫≠‡∫ö Deployment URL");
        } finally {
            document.getElementById('loader').style.display = 'none';
        }
    }

    function render(fleet, tours) {
        const container = document.getElementById('fleet');
        container.innerHTML = fleet.length === 0 ? '<p style="text-align:center;">--- ‡∫ö‡ªç‡ªà‡∫°‡∫µ‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡∫•‡∫ª‡∫î ---</p>' : '';
        
        fleet.forEach(car => {
            const active = tours.find(t => t.plate === car.plate && t.status === "Active");
            const card = document.createElement('div');
            card.className = `car-card ${active ? 'busy' : 'free'}`;
            card.innerHTML = `
                <div style="font-size:10px; position:absolute; top:10px; right:10px; color:${active ? 'red' : 'green'}; font-weight:bold;">
                    ${active ? 'üî¥ ‡∫ö‡ªç‡ªà‡∫´‡∫ß‡ªà‡∫≤‡∫á: ' + active.tourName : 'üü¢ ‡∫´‡∫ß‡ªà‡∫≤‡∫á'}
                </div>
                <div class="plate">${car.plate}</div>
                <div style="font-weight:700;">üë§ ${car.driver}</div>
                <div style="font-size:12px; color:#64748b;">üìû ${car.phone}</div>
            `;
            container.appendChild(card);
        });
    }

    async function addCar() {
        const p = document.getElementById('newP').value.trim();
        const d = document.getElementById('newD').value.trim();
        const ph = document.getElementById('newPh').value.trim();
        
        if(!p || !d) return alert("‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫õ‡ªâ‡∫≠‡∫ô‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô‡ªÉ‡∫´‡ªâ‡∫Ñ‡∫ª‡∫ö!");

        document.getElementById('loader').style.display = 'flex';
        try {
            await fetch(API_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ action: "ADD_CAR", plate: p, driver: d, phone: ph })
            });

            setTimeout(() => {
                document.getElementById('newP').value = '';
                document.getElementById('newD').value = '';
                document.getElementById('newPh').value = '';
                syncData();
            }, 2500);

        } catch (e) {
            alert("‚ùå ‡ªÄ‡∫Å‡∫µ‡∫î‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î: " + e.message);
            document.getElementById('loader').style.display = 'none';
        }
    }

    window.onload = syncData;
</script>
</body>
</html>
